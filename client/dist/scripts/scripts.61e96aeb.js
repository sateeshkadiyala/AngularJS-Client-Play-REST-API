"use strict";var angularJsPlayRestApiApp=angular.module("angularJsPlayRestApiApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngStorage","ngMaterial"]);angularJsPlayRestApiApp.run(["$rootScope","$window","$timeout",function(a,b,c){b.fbAsyncInit=function(){FB.init({appId:"352335531633537",channelUrl:"app/channel.html",status:!0,cookie:!0,xfbml:!0}),FB.Event.subscribe("auth.statusChange",function(b){a.$broadcast("fb_statusChange",{status:b.status})})},function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(document)}]).config(["$mdThemingProvider","$mdIconProvider",function(a,b){b.defaultIconSet("./assets/svg/avatars.svg",128).icon("menu","./assets/svg/menu.svg",24).icon("share","./assets/svg/share.svg",24).icon("google_plus","./assets/svg/google_plus.svg",512).icon("hangouts","./assets/svg/hangouts.svg",512).icon("twitter","./assets/svg/twitter.svg",512).icon("phone","./assets/svg/phone.svg",512),a.theme("default").primaryPalette("deep-purple").accentPalette("purple")}]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",controller:"loginCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/restricted",{templateUrl:"views/restricted.html",controller:"RestrictedCtrl",access:{requiresLogin:!0}}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$location",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.headers.Accept="Content-Type :application/json",a},responseError:function(c){return(401===c.status||403===c.status)&&b.path("/login"),a.reject(c)}}}])}]).run(["$rootScope","$location","UserService",function(a,b,c){a.$on("$routeChangeStart",function(a,d){void 0!==d.access&&d.access.requiresLogin&&(c.isLoggedIn||b.path("/login"))})}]),angular.module("angularJsPlayRestApiApp").factory("AuthService",["$rootScope","$q","UserService",function(a,b,c){var d={getLoginStatus:function(){FB.getLoginStatus(function(b){a.$broadcast("fb_statusChange",{status:b.status})},!0)},login:function(){FB.getLoginStatus(function(b){switch(b.status){case"connected":a.$broadcast("fb_connected",{facebook_id:b.authResponse.userID,auth_token:b.authResponse.accessToken,expires_in:b.authResponse.expiresIn});break;case"not_authorized":case"unknown":FB.login(function(b){b.authResponse?a.$broadcast("fb_connected",{facebook_id:b.authResponse.userID,auth_token:b.authResponse.accessToken,expires_in:b.authResponse.expiresIn,userNotAuthorized:!0}):a.$broadcast("fb_login_failed")},{scope:"read_stream, email"});break;default:FB.login(function(b){b.authResponse?(a.$broadcast("fb_connected",{facebook_id:b.authResponse.userID,auth_token:b.authResponse.accessToken,expires_in:b.authResponse.expiresIn}),a.$broadcast("fb_get_login_status")):a.$broadcast("fb_login_failed")})}},!0)},logout:function(){FB.logout(function(b){b?a.$broadcast("fb_logout_succeded"):a.$broadcast("fb_logout_failed")})},unsubscribe:function(){FB.api("/me/permissions","DELETE",function(b){a.$broadcast("fb_get_login_status")})}};return a.$on("fb_statusChange",function(b,c){a.fb_status=c.status,"connected"==c.status&&d.login()}),d}]);var app=angular.module("angularJsPlayRestApiApp");app.factory("UserService",["$localStorage","$rootScope","$http","$location",function(a,b,c,d){var e={isLoggedIn:!1,userName:"",authenticate:function(b){var f={};FB.api("/me",function(g){f={email:g.email,info:{accessToken:b.auth_token,expiresIn:b.expires_in}},c.post("/api/authenticate/facebook",f).success(function(b){a.token=b.token,d.path("/"),e.userName=g.name,e.isLoggedIn=!0}).error(function(){e.userName=null,e.isLoggedIn=!1,console.log("error logging in to the app.")})})}};return b.$on("fb_connected",function(a,b){e.authenticate(b)}),e}]),angular.module("angularJsPlayRestApiApp").controller("NavCtrl",["UserService","$scope","AuthService","$localStorage","$location","$http",function(a,b,c,d,e,f){b.hideLogin=function(){return a.isLoggedIn?!0:!1},b.logout=function(){c.logout(),f.get("api/authenticate/logout").success(function(b){a.userName=null,a.isLoggedIn=!1,d.token=null,e.path("/login"),console.log("user logged out")}).error(function(){console.log("error logging out")})}}]),angular.module("angularJsPlayRestApiApp").controller("loginCtrl",["AuthService","$scope","$rootScope","$http","$location","$localStorage","UserService",function(a,b,c,d,e,f,g){b.info={},c.$on("fb_get_login_status",function(){a.getLoginStatus()}),c.$on("fb_login_failed",function(){console.log("fb_login_failed")}),c.$on("fb_logout_succeded",function(){console.log("fb_logout_succeded"),c.id=""}),c.$on("fb_logout_failed",function(){console.log("fb_logout_failed!")}),b.getLoginStatus=function(){a.getLoginStatus()},b.login=function(){a.login()},b.unsubscribe=function(){a.unsubscribe()},b.getInfo=function(){FB.api("/"+c.session.facebook_id,function(a){console.log("Good to see you, "+a.name+".")}),c.info=c.session}}]),angular.module("angularJsPlayRestApiApp").controller("MainCtrl",["UserService","$scope",function(a,b){b.user=a}]),angular.module("angularJsPlayRestApiApp").controller("RestrictedCtrl",["$scope","$http","$localStorage",function(a,b,c){a.getSecrets=function(){var d={headers:{"Content-Type":"application/json","X-AUTH-TOKEN":c.token}};b.get("api/restricted",d).then(function(b){a.secrets=b.data.message,console.log(b.data.message)},function(){console.log("Failed to authenticate using Face Book")})}}]);